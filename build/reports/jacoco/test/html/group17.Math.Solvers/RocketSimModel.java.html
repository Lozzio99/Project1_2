<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RocketSimModel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Project_1.2</a> &gt; <a href="index.source.html" class="el_package">group17.Math.Solvers</a> &gt; <span class="el_source">RocketSimModel.java</span></div><h1>RocketSimModel.java</h1><pre class="source lang-java linenums">package group17.Math.Solvers;

import group17.Interfaces.*;
import group17.Math.Lib.Vector3D;
import group17.Simulation.Simulation;
import group17.Simulation.System.SolarSystem;

import static group17.Main.simulation;
import static group17.Utils.Config.*;

/**
 * The type Rocket sim model.
 */
<span class="nc bnc" id="L14" title="All 2 branches missed.">public class RocketSimModel {</span>
    /**
     * The constant targetPosition.
     */
    public static Vector3dInterface targetPosition;
    /**
     * The Solver.
     */

    static ODESolverInterface solver;
    /**
     * The Initial state.
     */
    static StateInterface initialState;

    /**
     * The constant pF.
     */

<span class="nc" id="L33">    public static NewtRaphFunction pF = vector -&gt; {</span>
<span class="nc" id="L34">        Vector3D aprxPos = (Vector3D) RocketSimModel.stateFx(NewtonRaphsonSolver.initPos, vector, NewtonRaphsonSolver.endTime);</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">        if (DEBUG) System.out.println(aprxPos.toString());</span>
<span class="nc" id="L36">        return targetPosition.sub(aprxPos);</span>
    };

    static {
<span class="nc" id="L40">        DEFAULT_SOLVER = MIDPOINT_SOLVER; // put here the best solver</span>
<span class="nc" id="L41">        STEP_SIZE = 200;</span>
<span class="nc" id="L42">        REPORT = false;</span>
<span class="nc" id="L43">        INSERT_ROCKET = true;</span>
<span class="nc" id="L44">        CHECK_COLLISIONS = false;</span>
<span class="nc" id="L45">        ERROR_EVALUATION = false;</span>
<span class="nc" id="L46">    }</span>

    /**
     * Create system system interface.
     *
     * @param initLocation the initial location
     * @param initVelocity the initial velocity
     * @return the system interface
     */
    public static SystemInterface createSystem(Vector3dInterface initLocation, Vector3dInterface initVelocity) {
<span class="nc" id="L56">        final SystemInterface[] system = new SystemInterface[1];</span>
<span class="nc" id="L57">        simulation = new Simulation() {</span>
            @Override
            public void initSystem() {
<span class="nc" id="L60">                system[0] = new SolarSystem();</span>
<span class="nc" id="L61">                system[0].initPlanets();</span>
<span class="nc" id="L62">                system[0].initClock();</span>
<span class="nc" id="L63">                system[0].initRocket();</span>
<span class="nc" id="L64">                system[0].initialState();</span>
<span class="nc" id="L65">                system[0].systemState().getPositions().set(11, initLocation);</span>
<span class="nc" id="L66">                system[0].systemState().getRateOfChange().getVelocities().set(11, initVelocity);</span>
<span class="nc" id="L67">            }</span>

            @Override
            public SystemInterface getSystem() {
<span class="nc" id="L71">                return system[0];</span>
            }
        };
<span class="nc" id="L74">        simulation.initSystem();</span>
<span class="nc" id="L75">        simulation.initUpdater();</span>
<span class="nc" id="L76">        return system[0];</span>
    }


    /**
     * State fx vector 3 d interface.
     *
     * @param initPos      the init pos
     * @param initVelocity the init velocity
     * @param timeFinal    the time final
     * @return the vector 3 d interface
     */
    public static Vector3dInterface stateFx(Vector3dInterface initPos, Vector3dInterface initVelocity, double timeFinal) {
        // init parameters
<span class="nc" id="L90">        SystemInterface system = createSystem(initPos, initVelocity);</span>
<span class="nc" id="L91">        initialState = system.systemState().copy();</span>
<span class="nc" id="L92">        solver = simulation.getUpdater().getSolver();</span>

        // solve trajectory
<span class="nc" id="L95">        StateInterface[] solution = solver.solve(solver.getFunction(), initialState, timeFinal, STEP_SIZE);</span>
<span class="nc bnc" id="L96" title="All 4 branches missed.">        assert (simulation.getSystem().getCelestialBodies().size() &gt; 10 &amp;&amp;</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">                !simulation.getSystem().getCelestialBodies().get(11).isCollided());</span>
<span class="nc" id="L98">        return solution[solution.length - 1].getPositions().get(11).clone();</span>
    }


    /**
     * The entry point of application.
     *
     * @param args the input arguments
     */
    /*public static void main(String[] args) {
        // FIXME: For some reason, simulation produces the same result every time no matter what :/
        Vector3D res1 = (Vector3D) stateFx(new Vector3D(-1.471922101663588E11, -2.860995816266412E10, 8278183.19359608), new Vector3D(10000, 1000000.0, 600000.0), 86700 * 1e2);
        System.out.println(res1.toString());
        Vector3D res2 = (Vector3D) stateFx(new Vector3D(0.0, 0.0, 0.0), new Vector3D(100, 100.0, 100.0), 1);
        System.out.println(res2.toString());

        //(-3.4594511332232066E24,1.8655241966218185E25,-4.1859192756969905E20)
        //(-3.4594511332232066E24,1.8655241966218185E25,-4.1859192756969905E20)
        //(-3.4594511332232066E24,1.8655241966218185E25,-4.1859192756969905E20)

    }*/

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>