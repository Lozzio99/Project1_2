<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Scene.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Project_1.2</a> &gt; <a href="index.source.html" class="el_package">group17.Graphics.Scenes</a> &gt; <span class="el_source">Scene.java</span></div><h1>Scene.java</h1><pre class="source lang-java linenums">package group17.Graphics.Scenes;


import group17.Math.Lib.Point3D;
import group17.Math.Lib.Point3DConverter;

import javax.imageio.ImageIO;
import javax.swing.*;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.Objects;

import static group17.Main.simulation;
import static group17.Utils.Config.PARTICLES_SIMULATION;
import static group17.Utils.Config.SIMULATION_LEVEL;

/**
 * Abstract class to Render a scene
 * to implement a Scene inherit from this class like this :
 * class MyScene extends Scene{
 * }
 * &lt;p&gt;
 * it is also possible to delegate the background painting
 * to the superclass with a call to the super.paintComponent(graphics)
 * {@link #paintComponent(Graphics)}
 * or to update the bodies positions and the mouse updates by a call
 * to the {@link #update()} and a consequent call to  {@link #resetMouse()}
 */
<span class="nc" id="L31">public abstract class Scene extends JPanel {</span>
    /**
     * The constant mouseSensitivity.
     */
    protected final static double mouseSensitivity = 16;
    /**
     * The unit size for the axis
     */
    private final static int UNIT_SIZE = 1410;//*(int) scale;
    /**
     * The constant mouse.
     */
    public static MouseInput mouse;
    /**
     * The constant initialX.
     */
    protected static int initialX,
    /**
     * The Initial y.
     */
    initialY,
    /**
     * The X.
     */
    x,
    /**
     * The Y.
     */
    y,
    /**
     * The X dif.
     */
    xDif,
    /**
     * The Y dif.
     */
    yDif,
    /**
     * The Delta x.
     */
    deltaX,
    /**
     * The Delta y.
     */
    deltaY,
    /**
     * The Total x dif.
     */
    totalXDif,
    /**
     * The Total y dif.
     */
    totalYDif;
    /**
     * The constant scale.
     */
<span class="nc" id="L87">    protected static double scale = 3e8;</span>
    /**
     * The Radius mag.
     */
<span class="nc" id="L91">    protected double radiusMag = 4e2;</span>
    /**
     * The Left.
     */
<span class="nc" id="L95">    protected Point3D left = new Point3D(-UNIT_SIZE, 0, 0),</span>
    /**
     * The Right.
     */
    right = new Point3D(UNIT_SIZE, 0, 0),
    /**
     * The Top.
     */
    top = new Point3D(0, UNIT_SIZE, 0),
    /**
     * The Bottom.
     */
    bottom = new Point3D(0, -UNIT_SIZE, 0),
    /**
     * The Front.
     */
    front = new Point3D(0, 0, UNIT_SIZE),
    /**
     * The Rear.
     */
    rear = new Point3D(0, 0, -UNIT_SIZE);
    /**
     * The background image
     */
    private BufferedImage image;
    /**
     * The Graphics object
     */
    private Graphics2D g;
<span class="nc" id="L124">    private boolean IMAGE_FAILED = false;</span>

    /**
     * Load and renders the background for the children scenes
     *
     * @param graphics the graphics object on which the background has to be painted
     */
    @Override
    public void paintComponent(Graphics graphics) {

        //super.paintComponent(graphics);

<span class="nc" id="L136">        g = (Graphics2D) graphics;</span>

<span class="nc bnc" id="L138" title="All 4 branches missed.">        if (!IMAGE_FAILED &amp;&amp; SIMULATION_LEVEL != PARTICLES_SIMULATION) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            if (image == null) {</span>
<span class="nc" id="L140">                create();</span>
<span class="nc" id="L141">                setHints(g);</span>
            } else {
<span class="nc" id="L143">                g.drawImage(image, 0, 0, simulation.getGraphics().getFrame().getWidth(),</span>
<span class="nc" id="L144">                        simulation.getGraphics().getFrame().getHeight(), 0, 0, image.getWidth(), image.getHeight(), new Color(0, 0, 0, 111), null);</span>
            }
        } else {
<span class="nc" id="L147">            g.setColor(Color.BLACK);</span>
<span class="nc" id="L148">            g.fillRect(0, 0, simulation.getGraphics().getFrame().getWidth(),</span>
<span class="nc" id="L149">                    simulation.getGraphics().getFrame().getHeight());</span>
        }

<span class="nc" id="L152">    }</span>


    /**
     * Improves the rendering performance as well as the scaling and coloring
     * interpolations
     *
     * @param g the graphics object to configure
     */
    public void setHints(Graphics2D g) {
<span class="nc" id="L162">        this.doLayout();</span>
<span class="nc" id="L163">        g.setRenderingHint(RenderingHints.KEY_ALPHA_INTERPOLATION, RenderingHints.VALUE_ALPHA_INTERPOLATION_QUALITY);</span>
<span class="nc" id="L164">        g.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="nc" id="L165">        g.setRenderingHint(RenderingHints.KEY_COLOR_RENDERING, RenderingHints.VALUE_COLOR_RENDER_QUALITY);</span>
<span class="nc" id="L166">        g.setRenderingHint(RenderingHints.KEY_DITHERING, RenderingHints.VALUE_DITHER_ENABLE);</span>
<span class="nc" id="L167">        g.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_ON);</span>
<span class="nc" id="L168">        g.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);</span>
<span class="nc" id="L169">        g.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);</span>
<span class="nc" id="L170">        g.setRenderingHint(RenderingHints.KEY_STROKE_CONTROL, RenderingHints.VALUE_STROKE_PURE);</span>
<span class="nc" id="L171">    }</span>

    /**
     * Loads the background image from resources
     */
    void create() {
        try {
<span class="nc" id="L178">            File f = new File(Objects.requireNonNull(Scene.class.getClassLoader().getResource(&quot;milky-way4k.jpg&quot;)).getFile());</span>
<span class="nc" id="L179">            image = ImageIO.read(f);</span>
<span class="nc" id="L180">        } catch (NullPointerException | IOException e) {</span>
<span class="nc" id="L181">            IMAGE_FAILED = true;</span>
<span class="nc" id="L182">            image = null;</span>
<span class="nc" id="L183">            System.err.println(e.getMessage() + &quot;\nPossible fix : make sure 'milky-way4k.jpg' is in resources&quot;);</span>
<span class="nc" id="L184">        }</span>
<span class="nc" id="L185">    }</span>


    /**
     * Init.
     */
    public abstract void init();


    /**
     * updates the mouse tracking variables to update the bodies if
     * any mouse event was generated
     *
     * @see SimulationScene#updateBodies() SimulationScene#updateBodies()SimulationScene#updateBodies()SimulationScene#updateBodies()SimulationScene#updateBodies()
     */
    public void update() {
<span class="nc" id="L201">        x = mouse.getX();</span>
<span class="nc" id="L202">        y = mouse.getY();</span>
<span class="nc" id="L203">        deltaX = deltaY = 0;</span>

<span class="nc bnc" id="L205" title="All 2 branches missed.">        if (mouse.getButton() == MouseInput.ClickType.LeftClick) {</span>
<span class="nc" id="L206">            deltaX = xDif = x - initialX;</span>
<span class="nc" id="L207">            this.rotateOnAxisY(false, xDif / mouseSensitivity);</span>
<span class="nc" id="L208">            totalXDif += xDif;</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">        } else if (mouse.getButton() == MouseInput.ClickType.RightClick) {</span>
<span class="nc" id="L210">            deltaY = yDif = y - initialY;</span>
<span class="nc" id="L211">            this.rotateOnAxisX(false, yDif / mouseSensitivity);</span>
<span class="nc" id="L212">            totalYDif += yDif;</span>
        }


<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (mouse.isScrollingUp()) {</span>
<span class="nc" id="L217">            Point3DConverter.zoomIn();</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">        } else if (mouse.isScrollingDown()) {</span>
<span class="nc" id="L219">            Point3DConverter.zoomOut();</span>
        }

        //call this from the subclass
        //this.resetMouse();

<span class="nc" id="L225">    }</span>

    /**
     * add the Mouse listener object to the scene
     *
     * @param mouse the mouse
     */
    public void addMouseControl(MouseInput mouse) {
<span class="nc" id="L233">        Scene.mouse = mouse;</span>
<span class="nc" id="L234">    }</span>

    /**
     * Reset the mouse events generated, after the update call,
     * in order to let them awake for the next frame,
     * avoiding such a call will lead to interminable mouse events such as
     * continuous spinning or zooming
     */
    public void resetMouse() {
<span class="nc" id="L243">        mouse.resetScroll();</span>
<span class="nc" id="L244">        initialX = x;</span>
<span class="nc" id="L245">        initialY = y;</span>
<span class="nc" id="L246">    }</span>

    /**
     * Rotates over the Y axis
     *
     * @param cw true if clockwise , false otherwise
     * @param y  the degree of rotation
     */
    public void rotateOnAxisY(boolean cw, double y) {
<span class="nc" id="L255">        Point3DConverter.rotateAxisY(top, cw, y);</span>
<span class="nc" id="L256">        Point3DConverter.rotateAxisY(bottom, cw, y);</span>
<span class="nc" id="L257">        Point3DConverter.rotateAxisY(left, cw, y);</span>
<span class="nc" id="L258">        Point3DConverter.rotateAxisY(right, cw, y);</span>
<span class="nc" id="L259">        Point3DConverter.rotateAxisY(rear, cw, y);</span>
<span class="nc" id="L260">        Point3DConverter.rotateAxisY(front, cw, y);</span>
<span class="nc" id="L261">    }</span>

    /**
     * Rotates over the X axis
     *
     * @param cw true if clockwise , false otherwise
     * @param x  the degree of rotation
     */
    void rotateOnAxisX(boolean cw, double x) {
<span class="nc" id="L270">        Point3DConverter.rotateAxisX(top, cw, x);</span>
<span class="nc" id="L271">        Point3DConverter.rotateAxisX(bottom, cw, x);</span>
<span class="nc" id="L272">        Point3DConverter.rotateAxisX(left, cw, x);</span>
<span class="nc" id="L273">        Point3DConverter.rotateAxisX(right, cw, x);</span>
<span class="nc" id="L274">        Point3DConverter.rotateAxisX(rear, cw, x);</span>
<span class="nc" id="L275">        Point3DConverter.rotateAxisX(front, cw, x);</span>
<span class="nc" id="L276">    }</span>

    /**
     * Rotates over the Z axis
     *
     * @param cw true if clockwise , false otherwise
     * @param z  the degree of rotation
     */
    void rotateOnAxisZ(boolean cw, double z) {
<span class="nc" id="L285">        Point3DConverter.rotateAxisZ(top, cw, z);</span>
<span class="nc" id="L286">        Point3DConverter.rotateAxisZ(bottom, cw, z);</span>
<span class="nc" id="L287">        Point3DConverter.rotateAxisZ(left, cw, z);</span>
<span class="nc" id="L288">        Point3DConverter.rotateAxisZ(right, cw, z);</span>
<span class="nc" id="L289">        Point3DConverter.rotateAxisZ(rear, cw, z);</span>
<span class="nc" id="L290">        Point3DConverter.rotateAxisZ(front, cw, z);</span>
<span class="nc" id="L291">    }</span>


    /**
     * enum for the scenes implementations
     */
<span class="nc" id="L297">    public enum SceneType {</span>
        /**
         * Only 3-dimensional axis and user suggestions
         */
<span class="nc" id="L301">        STARTING_SCENE,</span>
        /**
         * Renders the system state bodies
         */
<span class="nc" id="L305">        SIMULATION_SCENE</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>